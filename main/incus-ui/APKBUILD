pkgname=incus-ui
pkgver=0.18.0
pkgrel=1
pkgdesc="This package contains a web interface based on canonical/lxd-ui for incus."
url="https://github.com/lxc/incus"
arch="noarch"
license="Apache-2.0"
depends="
	"
makedepends="nodejs-current
            npm
			yarn
			"

options="net"
source="$pkgname-$pkgver.tar.gz::https://codeload.github.com/zabbly/incus-ui-canonical/tar.gz/refs/heads/main
	renames.sed
	"
builddir="$srcdir/incus-ui-canonical-main"

_project="github.com/zabbly/incus-ui-canonical"

prepare() {
	default_prepare
	sed -i -f "../../renames.sed" src/*/*.ts* src/*/*/*.ts* src/*/*/*/*.ts* src/*/*/*/*/*.ts*
	yarn install --frozen-lockfile --ignore-scripts
}

build() {
	NODE_ENV=production yarn build
}

package() {
	# Copy the build files to the package directory
	mkdir -p "$pkgdir/usr/incus/ui"
	cp -r build/* "$pkgdir/usr/incus/ui"
}

check() {
	echo "Running tests"
	# yarn test
}

sha512sums="
23cb57607798f83e699c1541dfdd842ead524a973ba855f5fffe4d83b1ead60555b72f231b1f36ddefa7d6430a75ed492020905784ff02732cb1ad4fd0826e02  incus-ui-0.18.0.tar.gz
cc882c01fdc81e4a0e13c4f0eec6ec9cf86053c688b4ce14b167b605825f9f47082977328c0a8d8c3f815a5ee98171cab070773d3ea5ae0186b0e227739ceb73  renames.sed
"
